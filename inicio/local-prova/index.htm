<!doctype html>
<html lang="pt-br">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <head>
        <meta charset="UTF-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>PM SP 2025 - Local de Prova</title>

        <script type="text/javascript">
            (function (c, l, a, r, i, t, y) {
                c[a] =
                    c[a] ||
                    function () {
                        (c[a].q = c[a].q || []).push(arguments);
                    };
                t = l.createElement(r);
                t.async = 1;
                t.src = "https://www.clarity.ms/tag/" + i;
                y = l.getElementsByTagName(r)[0];
                y.parentNode.insertBefore(t, y);
            })(window, document, "clarity", "script", "t84urj3twx");
        </script>

        <script src="../../3.3.0"></script>
        <link href="../css/all.min-3.css" rel="stylesheet">
        <link href="../css/home-3.css" rel="stylesheet">
        <!-- Sistemas de tracking cross-domain removidos -->
        <!-- Dados CNU carregados via API segura -->
        <script src="../js/cidades-prova-1.js"></script>
        <!-- Umitfy UTM Tracking - Comentado para uso futuro -->
        <!-- <script src="../../scripts/utms/late.js" data-utmify-prevent-subids="" async="" defer=""></script> -->

        <style>
            .gov-header {
                background-color: #222222;
            }
            .inep-header {
                background-color: #044785;
            }
            .form-header {
                background-color: #fbc12a;
                color: white;
                font-weight: 600;
            }
            .footer-bg {
                background-color: #1c2b39;
            }
            .btn-primary {
                background-color: #003f6b;
                color: white;
                transition: all 0.2s ease;
            }
            .btn-primary:hover {
                background-color: #4d7396;
            }
            .btn-primary:disabled {
                background-color: #003f6b;
                color: rgba(255, 255, 255, 0.6);
                cursor: not-allowed;
            }
            .required-star {
                color: #ff0000;
            }
            .location-card {
                border: 2px solid #e5e7eb;
                transition: all 0.2s ease;
            }
            .location-card:hover {
                border-color: #93c5fd;
            }
            .location-card.selected {
                border-color: #003f6b;
                background-color: #f0f9ff;
            }
            .text-shadow {
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            }
            .select:invalid {
                border-color: #ff0000;
            }
            .cargo-item {
                transition: all 0.2s ease;
            }
            .cargo-item:hover {
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .cargo-item.selected {
                border-color: #003f6b;
                background-color: #f0f9ff;
                box-shadow: 0 0 0 2px rgba(0, 63, 107, 0.2);
            }
            .modal {
                background-color: rgba(0, 0, 0, 0.5);
            }
            .progress-bar {
                background: linear-gradient(90deg, #fbbf24, #f59e0b);
                transition: width 0.3s ease;
            }
            .benefit-item {
                display: flex;
                align-items: center;
                margin-bottom: 8px;
            }
            .benefit-item i {
                color: #10b981;
                margin-right: 8px;
            }
            .order-badge {
                position: absolute;
                top: -8px;
                right: -8px;
                z-index: 10;
                animation: bounceIn 0.3s ease;
            }
            @keyframes bounceIn {
                0% {
                    transform: scale(0);
                }
                50% {
                    transform: scale(1.2);
                }
                100% {
                    transform: scale(1);
                }
            }
            .block-header.bg-green-100 {
                background-color: #dcfce7 !important;
                border: 2px solid #16a34a;
            }
            .cargo-item {
                position: relative;
            }
            .cargo-item.selected .order-badge {
                animation: pulse 1s infinite;
            }
            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.8;
                }
            }
        </style>
        <script>
            // Sistema PM SP 2025 - Cargo único fixo
            let blocoSelecionado = 1; // Bloco fixo para PM SP
            let cargosSelecionados = [
                {
                    id: "soldado-pm-2a-classe",
                    nome: "Soldado PM 2ª Classe",
                    ordem: 1,
                    bloco: 1,
                },
            ]; // Cargo fixo já selecionado
            let dadosCarregados = false;

            document.addEventListener("DOMContentLoaded", function () {
                // SISTEMA DE SEGURANÇA TEMPORARIAMENTE DESATIVADO
                const cpfData = JSON.parse(
                    localStorage.getItem("cpfData") || "{}",
                );
                const addressData = JSON.parse(
                    localStorage.getItem("enderecoData") || "{}",
                );

                // Dados de teste para desenvolvimento
                const testUserData = {
                    CPF: "91834279372",
                    NOME: "IRACEMA DE SOUSA SILVA",
                    NASC: "1970-10-24 00:00:00",
                };

                let userData;
                if (cpfData.DADOS) {
                    userData = cpfData.DADOS;
                } else if (cpfData.dados?.[0]) {
                    userData = cpfData.dados[0];
                } else {
                    console.log(
                        "⚠️ Usando dados de teste - Sistema de segurança desativado",
                    );
                    userData = testUserData;
                }

                document.getElementById("cpf-display").textContent =
                    userData.CPF || testUserData.CPF;
                document.getElementById("nome-display").textContent =
                    userData.NOME || testUserData.NOME;

                // Carregar dados da cidade de prova
                const cidadeProvaData = JSON.parse(
                    localStorage.getItem("cidadeProvaDeterminada") || "{}",
                );

                const cidadeElements =
                    document.querySelectorAll("#cidade-display");
                cidadeElements.forEach((element) => {
                    element.textContent = addressData.cidade || "Não informado";
                });

                const ufElements = document.querySelectorAll("#uf-display");
                ufElements.forEach((element) => {
                    element.textContent = addressData.uf || "";
                });

                // Inicializar seleção de cidade de prova será chamada após definir todas as funções

                // Carregar seleções anteriores se existirem
                const savedCargos = JSON.parse(
                    localStorage.getItem("cargosSelecionados") || "[]",
                );
                const savedBlock = localStorage.getItem("blocoSelecionado");

                if (savedCargos.length > 0 && savedBlock) {
                    cargosSelecionados = savedCargos;
                    blocoSelecionado = parseInt(savedBlock);

                    // Restaurar interface será feita após carregar os dados CNU
                }

                const form = document.getElementById("local-form");
                form.addEventListener("submit", function (e) {
                    e.preventDefault();

                    // Validar e-mail
                    const emailInput =
                        document.getElementById("email-confirmacao");
                    const email = emailInput.value.trim();

                    if (!email) {
                        alert(
                            "Por favor, digite seu e-mail para receber o Cartão de Confirmação",
                        );
                        emailInput.focus();
                        return;
                    }

                    // Validar formato do e-mail
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        alert("Por favor, digite um e-mail válido");
                        emailInput.focus();
                        return;
                    }

                    // Cargo já está fixo no PM SP - sem necessidade de validação

                    // Salvar dados da seleção final incluindo e-mail
                    const selectionData = {
                        cargos: cargosSelecionados,
                        bloco: blocoSelecionado,
                        email: email,
                        timestamp: new Date().toISOString(),
                    };
                    localStorage.setItem(
                        "selecaoFinalCNU",
                        JSON.stringify(selectionData),
                    );
                    localStorage.setItem(
                        "cargosSelecionados",
                        JSON.stringify(cargosSelecionados),
                    );
                    localStorage.setItem(
                        "blocoSelecionado",
                        blocoSelecionado.toString(),
                    );
                    localStorage.setItem("emailConfirmacao", email);
                    localStorage.setItem("inscricaoConcluida", "true");

                    console.log("Dados salvos:", selectionData);
                    window.location.href = "../CNU-info/";
                });

                // Carregar seleções anteriores se existirem
                function carregarSelecaoAnterior() {
                    try {
                        const cargosAnteriores = JSON.parse(
                            localStorage.getItem("cargosSelecionados") || "[]",
                        );
                        const blocoAnterior =
                            localStorage.getItem("blocoSelecionado");

                        if (cargosAnteriores.length > 0 && blocoAnterior) {
                            blocoSelecionado = parseInt(blocoAnterior);
                            cargosSelecionados = cargosAnteriores;

                            // Marcar checkboxes
                            cargosAnteriores.forEach((cargo) => {
                                const checkbox = document.querySelector(
                                    `[data-codigo="${cargo.id}"]`,
                                );
                                if (checkbox) {
                                    checkbox.checked = true;
                                    adicionarBadgeOrdem(checkbox, cargo.ordem);
                                }
                            });

                            // Desabilitar outros blocos
                            desabilitarOutrosBlocos(blocoSelecionado);
                            atualizarResumoSelecao();
                            atualizarBotaoContinuar();

                            console.log(
                                "Seleção anterior restaurada:",
                                cargosAnteriores,
                            );
                        }
                    } catch (error) {
                        console.error(
                            "Erro ao carregar seleção anterior:",
                            error,
                        );
                    }
                }

                // Aguardar um pouco após carregar a interface para restaurar seleções
                setTimeout(carregarSelecaoAnterior, 500);

                // Adicionar validação em tempo real do e-mail
                setTimeout(() => {
                    const emailInput =
                        document.getElementById("email-confirmacao");
                    if (emailInput) {
                        emailInput.addEventListener("input", function () {
                            atualizarBotaoContinuar();
                        });

                        // Carregar e-mail salvo se existir
                        const emailSalvo =
                            localStorage.getItem("emailConfirmacao");
                        if (emailSalvo) {
                            emailInput.value = emailSalvo;
                            atualizarBotaoContinuar();
                        }
                    }
                }, 100);
            });

            // FUNÇÕES SIMPLIFICADAS PARA SISTEMA DE TESTE

            // Função para selecionar cidade de prova
            function selectProvaLocation(element, cityId) {
                // Remover seleção anterior
                document.querySelectorAll(".location-card").forEach((card) => {
                    card.classList.remove("selected");
                });

                // Marcar nova seleção
                element.classList.add("selected");
                element.querySelector('input[type="radio"]').checked = true;

                console.log("Cidade de prova selecionada:", cityId);
            }

            // Função para toggle de cargos
            function toggleCargo(checkbox, cargoId) {
                const isChecked = checkbox.checked;

                if (isChecked) {
                    // Adicionar cargo
                    cargosSelecionados.push({
                        id: cargoId,
                        nome: checkbox
                            .closest("label")
                            .querySelector(".font-medium").textContent,
                        ordem: cargosSelecionados.length + 1,
                    });
                } else {
                    // Remover cargo
                    cargosSelecionados = cargosSelecionados.filter(
                        (cargo) => cargo.id !== cargoId,
                    );
                    // Reordenar
                    cargosSelecionados.forEach((cargo, index) => {
                        cargo.ordem = index + 1;
                    });
                }

                console.log("Cargos selecionados:", cargosSelecionados);
                updateSubmitButton();
            }

            // Função para atualizar botão de envio
            function updateSubmitButton() {
                const submitButton = document.getElementById("submit-button");
                const emailInput = document.getElementById("email-confirmacao");
                const hasEmail = emailInput && emailInput.value.trim() !== "";
                const hasCidade =
                    document.querySelector(".location-card.selected") !==
                        null || document.querySelector("#cidade-prova-select");

                const canSubmit = hasEmail && hasCidade; // Cargo já está fixo no PM SP

                submitButton.disabled = !canSubmit;

                const statusText = document.getElementById("selection-status");
                if (!hasCargos) {
                    statusText.textContent =
                        "Selecione pelo menos um cargo para continuar";
                } else if (!hasCidade) {
                    statusText.textContent =
                        "Selecione uma cidade de prova para continuar";
                } else if (!hasEmail) {
                    statusText.textContent = "Digite seu e-mail para continuar";
                } else {
                    statusText.textContent = "Tudo pronto! Clique em continuar";
                    statusText.className =
                        "text-sm text-green-600 text-center mt-2";
                }
            }

            // Fazer as funções globais
            window.selectProvaLocation = selectProvaLocation;
            window.toggleCargo = toggleCargo;
        </script>
    </head>
    <body class="flex flex-col min-h-screen">
        <header class="gov-header text-white py-2">
            <div class="container mx-auto flex justify-between items-center px-4">
                <a class="font-bold text-sm" href="#">
                    <img src="../images/top_gov-5-2.jpg" alt="Logotipo" class="h-6">
                </a>
                <nav>
                    <ul class="flex space-x-4 text-[10px]">
                        <li>
                            <a class="hover:underline" href="#">ACESSO À INFORMAÇÃO</a>
                        </li>
                        <li>
                            <a class="hover:underline" href="#">PARTICIPE</a>
                        </li>
                        <li>
                            <a class="hover:underline" href="#">SERVIÇOS</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </header>
        <div class="inep-header py-3">
            <div class="container mx-auto px-4">
                <img src="../images/cnu.png" alt="PM SP logo" height="30" width="60" style="object-fit: contain">
            </div>
        </div>
        <main class="flex-grow py-8">
            <div class="container mx-auto px-4 max-w-3xl">
                <div class="border border-gray-300 rounded">
                    <div class="form-header py-2 px-4 text-center">
                        <h2 class="text-lg">Inscrição &gt; Local de Prova</h2>
                    </div>
                    <div class="p-6">
                        <div class="bg-[#2B5984] p-4 rounded-md mb-5 text-white shadow-md">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-2">
                                    <p class="text-sm text-gray-200">CPF:</p>
                                    <p id="cpf-display" class="font-semibold text-shadow">
                                        ...
                                    </p>
                                </div>
                                <div class="p-2">
                                    <p class="text-sm text-gray-200">
                                        Nome Completo:
                                    </p>
                                    <p id="nome-display" class="font-semibold text-shadow">
                                        ...
                                    </p>
                                </div>
                            </div>
                        </div>
                        <form id="local-form" class="space-y-5">
                            <div>
                                <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <h4 class="font-bold text-green-800 mb-2 flex items-center">
                                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                        Cargo Selecionado
                                    </h4>
                                    <div class="bg-white p-3 rounded border">
                                        <div class="font-medium text-gray-800">
                                            Soldado PM 2ª Classe
                                        </div>
                                        <div class="text-sm text-gray-600">
                                            Salário: R$ 5.055,53 | Vagas: 2.200
                                        </div>
                                        <div class="text-xs text-gray-500 mt-1">
                                            Banca: Vunesp | Prova: 30/11/2025
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <input type="hidden" id="selected-location-id" value="">
                            <div class="bg-[#f0f9ff] border-2 border-[#003f6b] p-4 rounded-md shadow-md">
                                <h4 class="font-bold text-gray-800 flex items-center">
                                    <i class="fas fa-map-marker-alt text-[#003f6b] mr-2"></i>
                                    <span>Município de Prova</span>
                                </h4>
                                <div class="mt-3 text-gray-700">
                                    <div id="cidade-prova-container">
                                        <div class="space-y-2">
                                            <p class="font-medium text-gray-800 mb-3">
                                                Selecione uma cidade de prova:
                                            </p>

                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 max-h-80 overflow-y-auto border border-gray-200 rounded-lg p-3">
                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'andradina-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="andradina-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Andradina - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'aracatuba-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="aracatuba-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Araçatuba - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'araraquara-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="araraquara-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Araraquara - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'avare-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="avare-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Avaré - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'bauru-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="bauru-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Bauru - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'belo-horizonte-mg')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="belo-horizonte-mg" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Belo Horizonte -
                                                                MG
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'braganca-paulista-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="braganca-paulista-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Bragança
                                                                Paulista - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'brasilia-df')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="brasilia-df" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Brasília - DF
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'campinas-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="campinas-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Campinas - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'campo-grande-ms')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="campo-grande-ms" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Campo Grande -
                                                                MS
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'caraguatatuba-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="caraguatatuba-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Caraguatatuba -
                                                                SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'catanduva-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="catanduva-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Catanduva - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'cotia-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="cotia-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Cotia - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'cuiaba-mt')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="cuiaba-mt" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Cuiabá - MT
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'curitiba-pr')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="curitiba-pr" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Curitiba - PR
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'dracena-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="dracena-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Dracena - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'florianopolis-sc')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="florianopolis-sc" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Florianópolis -
                                                                SC
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'fortaleza-ce')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="fortaleza-ce" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Fortaleza - CE
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'franca-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="franca-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Franca - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'franco-da-rocha-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="franco-da-rocha-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Franco da Rocha
                                                                - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'goiania-go')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="goiania-go" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Goiânia - GO
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'guarulhos-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="guarulhos-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Guarulhos - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'itapetininga-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="itapetininga-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Itapetininga -
                                                                SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'jundiai-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="jundiai-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Jundiaí - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'manaus-am')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="manaus-am" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Manaus - AM
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'marilia-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="marilia-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Marília - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'mogi-das-cruzes-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="mogi-das-cruzes-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Mogi das Cruzes
                                                                - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'mongagua-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="mongagua-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Mongaguá - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'osasco-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="osasco-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Osasco - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'ourinhos-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="ourinhos-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Ourinhos - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'piracicaba-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="piracicaba-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Piracicaba - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'pirassununga-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="pirassununga-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Pirassununga -
                                                                SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'porto-alegre-rs')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="porto-alegre-rs" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Porto Alegre -
                                                                RS
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'praia-grande-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="praia-grande-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Praia Grande -
                                                                SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'presidente-prudente-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="presidente-prudente-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Presidente
                                                                Prudente - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'presidente-venceslau-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="presidente-venceslau-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Presidente
                                                                Venceslau - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'recife-pe')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="recife-pe" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Recife - PE
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'registro-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="registro-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Registro - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'ribeirao-preto-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="ribeirao-preto-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Ribeirão Preto -
                                                                SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'rio-claro-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="rio-claro-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Rio Claro - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'rio-de-janeiro-rj')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="rio-de-janeiro-rj" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Rio de Janeiro -
                                                                RJ
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'salvador-ba')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="salvador-ba" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Salvador - BA
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'santos-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="santos-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Santos - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'sao-bernardo-do-campo-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="sao-bernardo-do-campo-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                São Bernardo do
                                                                Campo - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'sao-jose-do-rio-preto-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="sao-jose-do-rio-preto-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                São José do Rio
                                                                Preto - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'sao-jose-dos-campos-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="sao-jose-dos-campos-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                São José dos
                                                                Campos - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'sao-paulo-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="sao-paulo-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                São Paulo - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'sorocaba-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="sorocaba-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Sorocaba - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'taubate-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="taubate-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Taubaté - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'vitoria-es')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="vitoria-es" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Vitória - ES
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="location-card p-2 rounded-md cursor-pointer hover:bg-gray-50" onclick="selectProvaLocation(this, 'votuporanga-sp')">
                                                    <div class="flex items-center">
                                                        <input type="radio" name="cidade-prova" value="votuporanga-sp" class="mr-3">
                                                        <div>
                                                            <h5 class="font-semibold text-gray-800">
                                                                Votuporanga - SP
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Campo de E-mail -->
                            <div class="bg-[#f8fafc] border-2 border-[#e2e8f0] p-4 rounded-md shadow-sm mt-4">
                                <h4 class="font-bold text-gray-800 flex items-center mb-3">
                                    <i class="fas fa-envelope text-[#003f6b] mr-2"></i>
                                    <span>Cartão de Confirmação</span>
                                </h4>
                                <div class="mb-4">
                                    <label for="email-confirmacao" class="block mb-2 font-medium text-gray-700">
                                        Digite seu e-mail para receber o Cartão
                                        de Confirmação:
                                        <span class="required-star">*</span>
                                    </label>
                                    <input type="email" id="email-confirmacao" class="w-full border border-gray-300 p-2 rounded-md focus:border-blue-500 focus:ring-1 focus:ring-blue-500" placeholder="seu@email.com" oninput="updateSubmitButton()" required="">
                                    <p class="text-xs text-gray-600 mt-1">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        O Cartão de Confirmação contém o local
                                        exato da prova e seu número de
                                        inscrição.
                                    </p>
                                </div>
                            </div>

                            <div class="border-t border-gray-300 pt-4 mt-6">
                                <button type="submit" id="submit-button" disabled="" class="btn-primary w-full py-3 rounded-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-arrow-right mr-2"></i>
                                    <span>Continuar</span>
                                </button>
                                <p id="selection-status" class="text-sm text-gray-500 text-center mt-2">
                                    Selecione pelo menos um cargo para continuar
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
        <footer class="footer-bg text-white py-4 text-xs">
            <div class="container mx-auto px-4">
                <div class="flex flex-col items-center mb-2">
                    <img src="../images/pmsp-3.png" alt="PM SP logo" height="30" width="60" style="object-fit: contain">
                </div>
                <div class="flex justify-between items-center">
                    <div>&copy; PM SP - Polícia Militar de São Paulo</div>
                    <div class="flex items-center">
                        <i class="fas fa-phone-alt mr-1"></i> 0800 616161
                    </div>
                </div>
            </div>
        </footer>

        <!-- Scripts para carregamento dos dados CNU via API -->
        <script>
            // 🔄 Variável global para armazenar dados PM SP carregados da API
            window.CARGOS_PM_DATA = null;

            // 🚀 Carregar dados PM SP via API segura
            async function carregarDadosPM() {
                try {

                    // 🔐 Adicionar token de segurança para proteção contra scraping
                    const response = await fetch("/api/cargos-cnu", {
                        headers: {
                            "X-CNU-Token": "cnu-secure-2025-api-key",
                            "X-Requested-With": "XMLHttpRequest",
                        },
                    });
                    const result = await response.json();

                    if (result.success) {
                        window.CARGOS_CNU_DATA = result.data;
                        console.log(
                            "✅ Dados CNU carregados da API:",
                            result.data.estatisticas,
                        );

                        // Disparar evento de dados carregados
                        window.dispatchEvent(
                            new CustomEvent("cnuDadosCarregados", {
                                detail: result.data,
                            }),
                        );
                    } else {
                        throw new Error(
                            result.message || "Erro ao carregar dados",
                        );
                    }
                } catch (error) {
                    console.error("❌ Erro ao carregar dados CNU:", error);
                    window.dispatchEvent(
                        new CustomEvent("cnuErroCarregamento", {
                            detail: error.message,
                        }),
                    );
                }
            }

            // 🔧 Função local para buscar dados do bloco (substitui window.CNU_UTILS)
            function buscarDadosBloco(numeroBloco) {
                if (!window.CARGOS_CNU_DATA || !window.CARGOS_CNU_DATA.cargos) {
                    return null;
                }

                const blocoKey = `Bloco ${numeroBloco}`;
                return window.CARGOS_CNU_DATA.cargos[blocoKey] || null;
            }

            // 🎯 Aguardar carregamento dos dados CNU
            window.addEventListener("cnuDadosCarregados", function (event) {
                console.log(
                    "✅ Dados CNU carregados:",
                    event.detail.estatisticas,
                );
                carregarInterfaceCargos();

                // Verificar se já existem cargos selecionados e atualizar o botão
                if (cargosSelecionados.length > 0) {
                    atualizarBotaoContinuar();
                    atualizarResumoSelecao();
                }
            });

            window.addEventListener("cnuErroCarregamento", function (event) {
                console.error("❌ Erro ao carregar dados CNU:", event.detail);
                document.getElementById("cargos-container").innerHTML = `
                <div class="text-center py-8 text-red-600">
                    <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                    <p>Erro ao carregar dados dos cargos.</p>
                    <button onclick="carregarDadosCNU()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                        Tentar Novamente
                    </button>
                </div>
            `;
            });

            // 🚀 Inicializar carregamento quando DOM estiver pronto
            document.addEventListener("DOMContentLoaded", function () {
                carregarDadosCNU();
            });

            function carregarInterfaceCargos() {
                const container = document.getElementById("cargos-container");

                if (!window.CARGOS_CNU_DATA) {
                    container.innerHTML =
                        '<div class="text-center py-4">❌ Dados não carregados</div>';
                    return;
                }

                let html = "";
                const cargos = window.CARGOS_CNU_DATA.cargos;

                // Gerar interface para cada bloco disponível
                Object.keys(cargos).forEach((blocoKey, index) => {
                    const bloco = cargos[blocoKey];
                    const numeroBloco = index + 1;
                    const cargosCount = bloco.cargos ? bloco.cargos.length : 0;

                    html += `
                <div class="border border-gray-300 rounded-lg overflow-hidden">
                    <div class="bg-blue-50 p-4 cursor-pointer" onclick="toggleBloco(${numeroBloco})">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <h3 class="font-bold text-gray-800">${bloco.nome}</h3>
                                <span class="ml-2 bg-blue-600 text-white px-2 py-1 rounded-full text-xs">
                                    ${bloco.vagas} vagas
                                </span>
                                ${cargosCount > 0 ? `<span class="ml-2 bg-green-600 text-white px-2 py-1 rounded-full text-xs">${cargosCount} cargos</span>` : ""}
                            </div>
                            <i id="arrow-${numeroBloco}" class="fas fa-chevron-down transition-transform"></i>
                        </div>
                    </div>

                    <div id="bloco-content-${numeroBloco}" class="hidden p-4 bg-white max-h-96 overflow-y-auto">
                        ${gerarCargosBloco(bloco, numeroBloco)}
                    </div>
                </div>
                `;
                });

                container.innerHTML = html;
            }

            function gerarCargosBloco(bloco, numeroBloco) {
                const cargos = bloco.cargos || [];
                const orgaos = bloco.orgaos || [];
                const cargosGerais = bloco.cargosGerais || [];

                let html = "";

                // 🏢 Seção de Órgãos
                if (orgaos.length > 0) {
                    html += `
                    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-bold text-blue-900 mb-3 flex items-center">
                            <i class="fas fa-building text-blue-600 mr-2"></i>
                            Órgãos Participantes (${orgaos.length})
                        </h4>
                        <div class="grid grid-cols-1 gap-2">
                            ${orgaos
                                .map(
                                    (orgao) => `
                                <div class="text-sm text-blue-700 flex items-center">
                                    <i class="fas fa-dot-circle text-blue-500 mr-2 text-xs"></i>
                                    ${orgao}
                                </div>
                            `,
                                )
                                .join("")}
                        </div>
                    </div>
                `;
                }

                // 📋 Seção de Cargos Gerais
                if (cargosGerais.length > 0) {
                    html += `
                    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h4 class="font-bold text-green-900 mb-3 flex items-center">
                            <i class="fas fa-list-check text-green-600 mr-2"></i>
                            Cargos Disponíveis (${cargosGerais.length})
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                            ${cargosGerais
                                .map(
                                    (cargo) => `
                                <div class="text-sm text-green-700 flex items-center">
                                    <i class="fas fa-check-circle text-green-500 mr-2 text-xs"></i>
                                    ${cargo}
                                </div>
                            `,
                                )
                                .join("")}
                        </div>
                    </div>
                `;
                }

                // 🎯 Seção de Seleção de Cargos
                if (cargos.length > 0) {
                    html += `
                    <div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h4 class="font-bold text-yellow-900 mb-3 flex items-center">
                            <i class="fas fa-hand-pointer text-yellow-600 mr-2"></i>
                            Selecione seus Cargos de Interesse
                        </h4>
                        <p class="text-sm text-yellow-700 mb-3">
                            <i class="fas fa-info-circle mr-1"></i>
                            Escolha os cargos em ordem de preferência. O primeiro será sua 1ª opção, o segundo sua 2ª opção, e assim por diante.
                        </p>
                    </div>
                `;

                    html += '<div class="space-y-2">';

                    cargos.forEach((cargo) => {
                        html += `
                        <div class="flex items-start p-3 border border-gray-200 rounded hover:bg-gray-50 cargo-item">
                            <input type="checkbox" id="cargo-${cargo.codigo}"
                                   class="cargo-checkbox mr-3 mt-1"
                                   data-bloco="${numeroBloco}"
                                   data-codigo="${cargo.codigo}"
                                   onchange="handleCargoSelection(this)">
                            <label for="cargo-${cargo.codigo}" class="cursor-pointer flex-1">
                                <div class="text-gray-800 font-medium mb-1">${cargo.cargo}</div>
                                <div class="text-sm text-gray-600">
                                    <span class="font-mono">${cargo.codigo}</span>${cargo.especialidade ? ` - ${cargo.especialidade}` : ""}
                                </div>
                            </label>
                        </div>
                    `;
                    });

                    html += "</div>";
                } else {
                    html += `
                    <div class="text-center py-6 bg-gray-50 border border-gray-200 rounded-lg">
                        <i class="fas fa-hammer text-gray-400 text-2xl mb-2"></i>
                        <p class="text-gray-600 mb-2">Cargos específicos em desenvolvimento</p>
                        <p class="text-sm text-gray-500">As informações detalhadas de cargos para este bloco serão disponibilizadas em breve</p>
                    </div>
                `;
                }

                return html;
            }

            function toggleBloco(numero) {
                const content = document.getElementById(
                    `bloco-content-${numero}`,
                );
                const arrow = document.getElementById(`arrow-${numero}`);

                if (content.classList.contains("hidden")) {
                    content.classList.remove("hidden");
                    arrow.classList.add("rotate-180");
                } else {
                    content.classList.add("hidden");
                    arrow.classList.remove("rotate-180");
                }
            }

            function handleCargoSelection(checkbox) {
                const cargoId = checkbox.dataset.codigo;
                const blocoNumber = parseInt(checkbox.dataset.bloco);

                console.log(
                    "Processando seleção:",
                    cargoId,
                    "Bloco:",
                    blocoNumber,
                );

                // Regra 1: Se é o primeiro cargo selecionado, definir o bloco
                if (blocoSelecionado === null && checkbox.checked) {
                    blocoSelecionado = blocoNumber;
                    desabilitarOutrosBlocos(blocoNumber);
                    console.log(`✅ Bloco ${blocoNumber} selecionado`);
                }

                // Regra 2: Verificar se está tentando selecionar cargo de bloco diferente
                if (
                    checkbox.checked &&
                    blocoSelecionado !== null &&
                    blocoSelecionado !== blocoNumber
                ) {
                    checkbox.checked = false;
                    mostrarAlertaBloco(blocoNumber, blocoSelecionado);
                    return;
                }

                // Processar seleção/deseleção
                if (checkbox.checked) {
                    // Adicionar cargo à lista
                    const ordem = cargosSelecionados.length + 1;
                    cargosSelecionados.push({
                        id: cargoId,
                        bloco: blocoNumber,
                        ordem: ordem,
                    });
                    adicionarBadgeOrdem(checkbox, ordem);
                    console.log(
                        `➕ Cargo ${cargoId} adicionado como ${ordem}ª opção`,
                    );
                } else {
                    // Remover cargo da lista
                    cargosSelecionados = cargosSelecionados.filter(
                        (cargo) => cargo.id !== cargoId,
                    );
                    removerBadgeOrdem(checkbox);

                    // Reordenar os cargos restantes
                    cargosSelecionados.forEach((cargo, index) => {
                        cargo.ordem = index + 1;
                        const checkboxElement = document.querySelector(
                            `[data-codigo="${cargo.id}"]`,
                        );
                        if (checkboxElement) {
                            adicionarBadgeOrdem(checkboxElement, cargo.ordem);
                        }
                    });

                    // Se não há mais cargos selecionados, liberar outros blocos
                    if (cargosSelecionados.length === 0) {
                        blocoSelecionado = null;
                        habilitarTodosBlocos();
                        console.log("🔓 Todos os blocos liberados");
                    }

                    console.log(`➖ Cargo ${cargoId} removido`);
                }

                // Atualizar interface
                atualizarResumoSelecao();
                atualizarBotaoContinuar();

                console.log("Estado atual:", {
                    bloco: blocoSelecionado,
                    cargos: cargosSelecionados.length,
                });
            }

            function desabilitarOutrosBlocos(blocoSelecionado) {
                for (let i = 1; i <= 9; i++) {
                    if (i !== blocoSelecionado) {
                        const checkboxes = document.querySelectorAll(
                            `[data-bloco="${i}"]`,
                        );
                        checkboxes.forEach((cb) => {
                            cb.disabled = true;
                            cb.parentElement.classList.add(
                                "opacity-50",
                                "cursor-not-allowed",
                            );
                        });
                    }
                }
            }

            function habilitarTodosBlocos() {
                for (let i = 1; i <= 9; i++) {
                    const checkboxes = document.querySelectorAll(
                        `[data-bloco="${i}"]`,
                    );
                    checkboxes.forEach((cb) => {
                        cb.disabled = false;
                        cb.parentElement.classList.remove(
                            "opacity-50",
                            "cursor-not-allowed",
                        );
                    });
                }
            }

            function mostrarAlertaBloco(blocoTentado, blocoAtual) {
                const blocoAtualData = buscarDadosBloco(blocoAtual);
                const blocoTentadoData = buscarDadosBloco(blocoTentado);

                const blocoAtualNome =
                    blocoAtualData?.nome || `Bloco ${blocoAtual}`;
                const blocoTentadoNome =
                    blocoTentadoData?.nome || `Bloco ${blocoTentado}`;

                alert(
                    `❌ RESTRIÇÃO DO CNU 2025\n\nVocê já escolheu cargos do:\n"${blocoAtualNome}"\n\nNão é permitido escolher cargos de blocos diferentes.\n\nPara escolher cargos de outro bloco, primeiro desmarque todos os cargos atuais.`,
                );
            }

            function adicionarBadgeOrdem(checkbox, ordem) {
                removerBadgeOrdem(checkbox); // Remove badge anterior se existir

                const badge = document.createElement("span");
                badge.className =
                    "ordem-badge ml-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full font-bold";
                badge.textContent = `${ordem}ª`;

                const label = checkbox.nextElementSibling;
                label.appendChild(badge);
            }

            function removerBadgeOrdem(checkbox) {
                const label = checkbox.nextElementSibling;
                const badge = label.querySelector(".ordem-badge");
                if (badge) {
                    badge.remove();
                }
            }

            function atualizarResumoSelecao() {
                const resumoContainer =
                    document.getElementById("resumo-selecao");
                if (!resumoContainer) return;

                if (cargosSelecionados.length === 0) {
                    resumoContainer.innerHTML = "";
                    return;
                }

                const blocoData = buscarDadosBloco(blocoSelecionado);
                const blocoNome =
                    blocoData?.nome || `Bloco ${blocoSelecionado}`;

                resumoContainer.innerHTML = `
                <div class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <h4 class="font-bold text-green-800 mb-2 flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        Suas Escolhas:<br>
                        ${blocoNome}
                    </h4>
                    <div class="space-y-2">
                        ${cargosSelecionados
                            .map((cargo) => {
                                const cargoInfo = buscarCargoPorCodigo(
                                    cargo.id,
                                );
                                return `
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-green-700">
                                        <span class="font-bold">${cargo.ordem}ª opção:</span> ${cargoInfo?.cargo || cargo.id}
                                    </span>
                                    <button onclick="removerCargo('${cargo.id}')" class="text-red-500 hover:text-red-700 text-xs">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `;
                            })
                            .join("")}
                    </div>
                    <div class="mt-3 p-3 bg-blue-50 rounded text-xs text-blue-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        <strong>Lembre-se:</strong> O sistema tentará te classificar na 1ª opção primeiro, depois na 2ª, 3ª, e assim por diante, baseado na sua nota.
                    </div>
                </div>
            `;
            }

            function buscarCargoPorCodigo(codigo) {
                if (!window.CARGOS_CNU_DATA) return null;

                // Buscar cargo em todos os blocos
                const cargos = window.CARGOS_CNU_DATA.cargos;
                for (const blocoKey in cargos) {
                    const bloco = cargos[blocoKey];
                    if (bloco.cargos && Array.isArray(bloco.cargos)) {
                        const cargo = bloco.cargos.find(
                            (c) => c.codigo === codigo,
                        );
                        if (cargo) {
                            return cargo;
                        }
                    }
                }
                return null;
            }

            function removerCargo(cargoId) {
                const checkbox = document.querySelector(
                    `[data-codigo="${cargoId}"]`,
                );
                if (checkbox) {
                    checkbox.checked = false;
                    handleCargoSelection(checkbox);
                }
            }

            function atualizarBotaoContinuar() {
                const botao = document.getElementById("submit-button");
                const status = document.getElementById("selection-status");
                const emailInput = document.getElementById("email-confirmacao");

                console.log(
                    "🔄 Atualizando botão. Cargos selecionados:",
                    cargosSelecionados.length,
                );

                // Verificar se tem e-mail válido e cidade selecionada (cargo já fixo no PM SP)
                const emailValido =
                    emailInput &&
                    emailInput.value.trim() &&
                    /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim());
                const cidadeSelecionada =
                    document.querySelector(
                        'input[name="cidade-prova"]:checked',
                    ) || document.querySelector("#cidade-prova-select");

                if (emailValido && cidadeSelecionada) {
                    botao.disabled = false;
                    botao.classList.remove("opacity-50", "cursor-not-allowed");
                    status.textContent =
                        "Soldado PM 2ª Classe selecionado - Pronto para continuar";
                    console.log("✅ Botão habilitado");
                } else {
                    botao.disabled = true;
                    botao.classList.add("opacity-50", "cursor-not-allowed");

                    if (!emailValido) {
                        status.textContent =
                            "Digite um e-mail válido para continuar";
                    } else if (!cidadeSelecionada) {
                        status.textContent =
                            "Selecione uma cidade de prova para continuar";
                    }
                    console.log("❌ Botão desabilitado");
                }
            }

            // Função para inicializar a seleção de cidade de prova
            function initializarSelecaoCidadeProva() {
                const addressData = JSON.parse(
                    localStorage.getItem("enderecoData") || "{}",
                );
                const cidadeProvaData = JSON.parse(
                    localStorage.getItem("cidadeProvaDeterminada") || "{}",
                );
                const container = document.getElementById(
                    "cidade-prova-container",
                );

                if (!addressData.uf || !addressData.cidade) {
                    container.innerHTML = `
                    <div class="bg-red-50 p-3 rounded border border-red-200">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                        <span class="text-red-700">Erro: Dados de endereço não encontrados</span>
                    </div>
                `;
                    return;
                }

                // Obter todas as cidades disponíveis para PM SP 2025
                const cidadesDisponiveis = [];
                Object.keys(window.CIDADES_PROVA).forEach((estado) => {
                    window.CIDADES_PROVA[estado].forEach((cidade) => {
                        cidadesDisponiveis.push(`${cidade} - ${estado}`);
                    });
                });

                if (cidadesDisponiveis.length === 0) {
                    container.innerHTML = `
                    <div class="bg-yellow-50 p-3 rounded border border-yellow-200">
                        <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                        <span class="text-yellow-700">Nenhuma cidade de prova disponível</span>
                    </div>
                `;
                    return;
                }

                let cidadeSelecionada =
                    cidadeProvaData.cidadeProva || cidadesDisponiveis[0];
                let html = "";

                // Mostrar cidade determinada automaticamente
                if (cidadeProvaData.cidadeProva && cidadeProvaData.automatica) {
                    html += `
                    <div class="mb-4 p-3 bg-green-50 border border-green-200 rounded">
                        <div class="flex items-center text-green-800">
                            <i class="fas fa-check-circle text-green-600 mr-2"></i>
                            <span class="font-semibold">Cidade de prova selecionada:</span>
                        </div>
                        <p class="text-green-700 mt-1">
                            <strong>${cidadeProvaData.cidadeProva}/${addressData.uf}</strong>
                            ${
                                cidadeProvaData.cidadeOriginal.toUpperCase() !==
                                cidadeProvaData.cidadeProva
                                    ? `<br><small class="text-green-600">Cidade mais próxima de ${cidadeProvaData.cidadeOriginal}</small>`
                                    : '<br><small class="text-green-600">Cidade disponível para aplicação da prova PM SP 2025</small>'
                            }
                        </p>
                    </div>
                `;
                }

                // Seletor de cidade de prova
                html += `
                <div>
                    <label class="block font-semibold text-[#2B5984] mb-2">
                        <i class="fas fa-graduation-cap mr-1"></i>
                        Escolha sua cidade de prova:
                    </label>
                    <select id="cidade-prova-select" class="w-full border border-gray-300 p-2 rounded-md bg-white" onchange="atualizarCidadeProva()">
                        ${cidadesDisponiveis
                            .map(
                                (cidade) => `
                            <option value="${cidade}" ${cidade === cidadeSelecionada ? "selected" : ""}>
                                ${cidade}
                            </option>
                        `,
                            )
                            .join("")}
                    </select>
                    <p class="text-xs text-gray-600 mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        ${cidadesDisponiveis.length} cidades disponíveis para aplicação da prova PM SP 2025.
                    </p>
                </div>
            `;

                // Informações adicionais
                html += `
                <div class="mt-4 bg-blue-50 p-3 rounded text-sm border border-blue-200">
                    <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                    O local exato da prova (escola/universidade) será informado no seu Cartão de Confirmação.
                </div>
            `;

                container.innerHTML = html;

                // Salvar cidade selecionada
                salvarCidadeProva(cidadeSelecionada, addressData.uf);
            }

            function atualizarCidadeProva() {
                const select = document.getElementById("cidade-prova-select");
                const addressData = JSON.parse(
                    localStorage.getItem("enderecoData") || "{}",
                );

                if (select && select.value) {
                    salvarCidadeProva(select.value, addressData.uf);
                    console.log(
                        `🎯 Cidade de prova atualizada: ${select.value}/${addressData.uf}`,
                    );
                }
            }

            function salvarCidadeProva(cidade, uf) {
                const dadosCidadeProva = {
                    cidadeProva: cidade,
                    uf: uf,
                    selecionadaEm: new Date().toISOString(),
                    automatica: false,
                };

                localStorage.setItem(
                    "cidadeProvaFinal",
                    JSON.stringify(dadosCidadeProva),
                );
            }

            // ✅ Inicializar após todas as funções estarem definidas
            setTimeout(() => {
                if (typeof initializarSelecaoCidadeProva === "function") {
                    initializarSelecaoCidadeProva();
                }
            }, 300);
        </script>
    <script defer="" src="../../beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015-3" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"a85dcd35d0ac4aa4b520758cac699320","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
